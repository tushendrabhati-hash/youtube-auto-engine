name: YouTube Auto Upload

on:
  workflow_dispatch:
  schedule:
    # Runs daily at 5:30 PM IST (12:00 UTC)
    - cron: '0 12 * * *'

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install ffmpeg -y
        pip install google-api-python-client google-auth google-auth-oauthlib

    # üé¨ Create demo vertical shorts video
    - name: Create demo video
      run: |
        ffmpeg -f lavfi -i color=c=black:s=1080x1920:d=10 \
        -vf "drawtext=text='AUTO UPLOAD WORKING':fontsize=60:fontcolor=white:x=(w-text_w)/2:y=(h-text_h)/2" \
        output.mp4

    # ‚è± RANDOM DELAY (6‚Äì8 PM IST upload window)
    - name: Random upload delay
      run: |
        echo "Waiting random time before upload..."
        DELAY=$((RANDOM % 7200))
        echo "Sleeping for $DELAY seconds"
        sleep $DELAY

    # üöÄ Upload video to YouTube
    - name: Upload to YouTube
      env:
        YT_CREDENTIALS: ${{ secrets.YT_CREDENTIALS }}
      run: python Upload.py
