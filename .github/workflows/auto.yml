name: YouTube Auto Upload

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *'   # 5:30 PM IST daily

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:

    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install ffmpeg -y
        pip install google-api-python-client \
                    google-auth \
                    google-auth-oauthlib \
                    feedparser \
                    yt-dlp

    - name: Detect new videos
      run: python detect.py | tee detect.log

    - name: Download detected video
      run: python download.py

    - name: Edit video automatically
      run: python edit.py

    - name: Random upload delay
      run: |
        echo "Random wait before upload..."
        DELAY=$((RANDOM % 7200))
        sleep $DELAY

    - name: Upload to YouTube
      env:
        YT_CREDENTIALS: ${{ secrets.YT_CREDENTIALS }}
      run: python Upload.py
